<nav class="navbar" [class.scrolled]="isScrolled" [class.mobile-menu-open]="mobileMenuOpen">
    <div class="container">
        <!-- Logo -->
        <a routerLink="/" class="logo">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                <rect width="32" height="32" rx="8" fill="var(--primary)" />
                <text x="16" y="22" text-anchor="middle" fill="white" font-family="Arial" font-size="14"
                    font-weight="bold">NM</text>
            </svg>
            <span>NicheMarket</span>
        </a>

        <!-- Navigation desktop -->
        <div class="nav-links">
            <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
                Accueil
            </a>
            <a routerLink="/annonces" routerLinkActive="active">
                Annonces
            </a>
            <a routerLink="/categories" routerLinkActive="active">
                Catégories
            </a>
            @if (user) {
            <a routerLink="/messages" routerLinkActive="active">
                Messages
                @if (unreadCount > 0) {
                <span class="badge">{{ unreadCount }}</span>
                }
            </a>
            }
        </div>

        <!-- Actions -->
        <div class="nav-actions">
            @if (user) {
            <div class="user-menu">
                <button class="user-btn" (click)="toggleUserMenu()">
                    <img [src]="user.avatar || 'assets/default-avatar.jpg'" [alt]="user.fullName" class="avatar" />
                    <span class="username">{{ user.username }}</span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>

                @if (showUserMenu) {
                <div class="dropdown-menu">
                    <a routerLink="/profil" class="dropdown-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M20 21V19C20 16.7909 18.2091 15 16 15H8C5.79086 15 4 16.7909 4 19V21"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" />
                        </svg>
                        Mon profil
                    </a>
                    <a routerLink="/profil/annonces" class="dropdown-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" />
                            <path d="M3 9H21" stroke="currentColor" stroke-width="2" />
                            <path d="M9 21V9" stroke="currentColor" stroke-width="2" />
                        </svg>
                        Mes annonces
                    </a>
                    @if (user.isAdmin) {
                    <a routerLink="/admin" class="dropdown-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <rect x="4" y="4" width="16" height="16" rx="2" stroke="currentColor" stroke-width="2" />
                            <path d="M9 12H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            <path d="M12 9V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        Administration
                    </a>
                    }
                    <hr class="dropdown-divider" />
                    <button class="dropdown-item text-danger" (click)="logout()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path
                                d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        Déconnexion
                    </button>
                </div>
                }
            </div>

            <app-button routerLink="/annonces/nouveau" variant="primary" size="sm" class="create-btn">
                + Publier
            </app-button>
            } @else {
            <div class="auth-buttons">
                <a routerLink="/connexion" class="auth-link">Connexion</a>
                <app-button routerLink="/inscription" variant="primary" size="sm">
                    Inscription
                </app-button>
            </div>
            }

            <!-- Menu burger mobile -->
            <button class="menu-toggle" (click)="toggleMobileMenu()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M3 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    <path d="M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    <path d="M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Menu mobile -->
    @if (mobileMenuOpen) {
    <div class="mobile-menu">
        <div class="mobile-menu-header">
            <span>Menu</span>
            <button class="close-btn" (click)="toggleMobileMenu()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </button>
        </div>

        <div class="mobile-menu-links">
            <a routerLink="/" (click)="toggleMobileMenu()" routerLinkActive="active"
                [routerLinkActiveOptions]="{exact: true}">
                Accueil
            </a>
            <a routerLink="/annonces" (click)="toggleMobileMenu()" routerLinkActive="active">
                Annonces
            </a>
            <a routerLink="/categories" (click)="toggleMobileMenu()" routerLinkActive="active">
                Catégories
            </a>
            @if (user) {
            <a routerLink="/messages" (click)="toggleMobileMenu()" routerLinkActive="active">
                Messages
                @if (unreadCount > 0) {
                <span class="badge">{{ unreadCount }}</span>
                }
            </a>
            <a routerLink="/profil" (click)="toggleMobileMenu()">
                Mon profil
            </a>
            <a routerLink="/profil/annonces" (click)="toggleMobileMenu()">
                Mes annonces
            </a>
            @if (user.isAdmin) {
            <a routerLink="/admin" (click)="toggleMobileMenu()">
                Administration
            </a>
            }
            <hr />
            <button class="logout-btn" (click)="logout()">
                Déconnexion
            </button>
            } @else {
            <div class="mobile-auth">
                <app-button routerLink="/connexion" class="auth-link" (click)="toggleMobileMenu()" variant="primary" size="sm"
                    fullWidth>
                    Connexion
                </app-button>
                <app-button routerLink="/inscription" class="auth-link" (click)="toggleMobileMenu()" variant="primary" size="sm"
                    fullWidth>
                    Inscription
                </app-button>
            </div>
            }
        </div>
    </div>
    }
</nav>